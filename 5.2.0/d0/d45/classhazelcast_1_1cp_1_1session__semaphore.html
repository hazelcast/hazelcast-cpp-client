<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hazelcast C++ Client: hazelcast::cp::session_semaphore Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../IMDG_blue_logo_square_RGB-dark_200px.png"/></td>
  <td id="projectalign">
   <div id="projectname">Hazelcast C++ Client
   </div>
   <div id="projectbrief">Hazelcast C++ Client Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-static-attribs">Static Protected Attributes</a> &#124;
<a href="../../db/d89/classhazelcast_1_1cp_1_1session__semaphore-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">hazelcast::cp::session_semaphore Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="../../closed.png" alt="+"/> Inheritance diagram for hazelcast::cp::session_semaphore:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
 <div class="center">
  <img src="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.png" alt=""/>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8190cc78ebb9e96669a78daabe89503a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a8190cc78ebb9e96669a78daabe89503a">session_semaphore</a> (const std::string &amp;proxy_name, client::spi::ClientContext *context, const <a class="el" href="../../d2/da4/structhazelcast_1_1cp_1_1raft__group__id.html">raft_group_id</a> &amp;group_id, const std::string &amp;object_name, internal::session::proxy_session_manager &amp;session_manager)</td></tr>
<tr class="separator:a8190cc78ebb9e96669a78daabe89503a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab727f06ad373c2519f0c5ca1257f84ae"><td class="memItemLeft" align="right" valign="top">boost::future&lt; void &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#ab727f06ad373c2519f0c5ca1257f84ae">acquire</a> (int32_t permits) override</td></tr>
<tr class="separator:ab727f06ad373c2519f0c5ca1257f84ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae667563d56071817a96d531ad7c0a5ce"><td class="memItemLeft" align="right" valign="top">boost::future&lt; void &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#ae667563d56071817a96d531ad7c0a5ce">release</a> (int32_t permits) override</td></tr>
<tr class="separator:ae667563d56071817a96d531ad7c0a5ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a587436f67435d1e51a0a94558d01ee2d"><td class="memItemLeft" align="right" valign="top">boost::future&lt; int32_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a587436f67435d1e51a0a94558d01ee2d">drain_permits</a> () override</td></tr>
<tr class="separator:a587436f67435d1e51a0a94558d01ee2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:ad6838bccb7f850abcb34ac8596bfae43"><td class="memItemLeft" align="right" valign="top">boost::future&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#ad6838bccb7f850abcb34ac8596bfae43">try_acquire_for_millis</a> (int32_t permits, std::chrono::milliseconds timeout) override</td></tr>
<tr class="separator:ad6838bccb7f850abcb34ac8596bfae43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76c8b1a49de450489ca52579999b9e19"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a76c8b1a49de450489ca52579999b9e19">throw_illegal_state_exception</a> (std::exception_ptr e)</td></tr>
<tr class="separator:a76c8b1a49de450489ca52579999b9e19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e34f99259acb9505b168284025de536"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a1e34f99259acb9505b168284025de536">get_thread_id</a> () override</td></tr>
<tr class="separator:a1e34f99259acb9505b168284025de536"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a052e014655cad49b69f0f88bcabf95ae"><td class="memItemLeft" align="right" valign="top">boost::future&lt; void &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a052e014655cad49b69f0f88bcabf95ae">do_change_permits</a> (int32_t delta) override</td></tr>
<tr class="separator:a052e014655cad49b69f0f88bcabf95ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-static-attribs" name="pro-static-attribs"></a>
Static Protected Attributes</h2></td></tr>
<tr class="memitem:a45e61b07294a4b94d54b40595264c917"><td class="memItemLeft" align="right" valign="top">static constexpr int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a45e61b07294a4b94d54b40595264c917">DRAIN_SESSION_ACQ_COUNT</a> = 1024</td></tr>
<tr class="memdesc:a45e61b07294a4b94d54b40595264c917"><td class="mdescLeft">&#160;</td><td class="mdescRight">Since a proxy does not know how many permits will be drained on the Raft group, it uses this constant to increment its local session acquire count.  <br /></td></tr>
<tr class="separator:a45e61b07294a4b94d54b40595264c917"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="../../d0/d1d/cp_8h_source.html#l01278">1278</a> of file <a class="el" href="../../d0/d1d/cp_8h_source.html">cp.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a8190cc78ebb9e96669a78daabe89503a" name="a8190cc78ebb9e96669a78daabe89503a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8190cc78ebb9e96669a78daabe89503a">&#9670;&#160;</a></span>session_semaphore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hazelcast::cp::session_semaphore::session_semaphore </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>proxy_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">client::spi::ClientContext *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d2/da4/structhazelcast_1_1cp_1_1raft__group__id.html">raft_group_id</a> &amp;&#160;</td>
          <td class="paramname"><em>group_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>object_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">internal::session::proxy_session_manager &amp;&#160;</td>
          <td class="paramname"><em>session_manager</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/d2a/cp_8cpp_source.html#l01172">1172</a> of file <a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1178</span>  : counting_semaphore(proxy_name,</div>
<div class="line"><span class="lineno"> 1179</span>                       context,</div>
<div class="line"><span class="lineno"> 1180</span>                       group_id,</div>
<div class="line"><span class="lineno"> 1181</span>                       object_name,</div>
<div class="line"><span class="lineno"> 1182</span>                       session_manager)</div>
<div class="line"><span class="lineno"> 1183</span>{}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab727f06ad373c2519f0c5ca1257f84ae" name="ab727f06ad373c2519f0c5ca1257f84ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab727f06ad373c2519f0c5ca1257f84ae">&#9670;&#160;</a></span>acquire()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::future&lt; void &gt; hazelcast::cp::session_semaphore::acquire </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>permits</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/d2a/cp_8cpp_source.html#l01186">1186</a> of file <a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1187</span>{</div>
<div class="line"><span class="lineno"> 1188</span>    <span class="keywordflow">return</span> to_void_future(</div>
<div class="line"><span class="lineno"> 1189</span>      try_acquire_for_millis(permits, std::chrono::milliseconds(-1)));</div>
<div class="line"><span class="lineno"> 1190</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a052e014655cad49b69f0f88bcabf95ae" name="a052e014655cad49b69f0f88bcabf95ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a052e014655cad49b69f0f88bcabf95ae">&#9670;&#160;</a></span>do_change_permits()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::future&lt; void &gt; hazelcast::cp::session_semaphore::do_change_permits </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>delta</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/d2a/cp_8cpp_source.html#l01355">1355</a> of file <a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1356</span>{</div>
<div class="line"><span class="lineno"> 1357</span>    <span class="keyword">auto</span> session_id =</div>
<div class="line"><span class="lineno"> 1358</span>      session_manager_.acquire_session(group_id_, <a class="code hl_variable" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a45e61b07294a4b94d54b40595264c917">DRAIN_SESSION_ACQ_COUNT</a>);</div>
<div class="line"><span class="lineno"> 1359</span>    <span class="keyword">auto</span> thread_id = get_thread_id();</div>
<div class="line"><span class="lineno"> 1360</span>    <span class="keyword">auto</span> invocation_uid =</div>
<div class="line"><span class="lineno"> 1361</span>      get_context().get_hazelcast_client_implementation()-&gt;random_uuid();</div>
<div class="line"><span class="lineno"> 1362</span> </div>
<div class="line"><span class="lineno"> 1363</span>    <span class="keyword">auto</span> request = client::protocol::codec::semaphore_change_encode(</div>
<div class="line"><span class="lineno"> 1364</span>      group_id_, object_name_, session_id, thread_id, invocation_uid, delta);</div>
<div class="line"><span class="lineno"> 1365</span>    <span class="keywordflow">return</span> client::spi::impl::ClientInvocation::create(</div>
<div class="line"><span class="lineno"> 1366</span>             context_, request, object_name_)</div>
<div class="line"><span class="lineno"> 1367</span>      -&gt;invoke()</div>
<div class="line"><span class="lineno"> 1368</span>      .then(boost::launch::sync,</div>
<div class="line"><span class="lineno"> 1369</span>            [=](boost::future&lt;client::protocol::ClientMessage&gt; f) {</div>
<div class="line"><span class="lineno"> 1370</span>                <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1371</span>                    f.get();</div>
<div class="line"><span class="lineno"> 1372</span>                    session_manager_.release_session(group_id_, session_id);</div>
<div class="line"><span class="lineno"> 1373</span>                } <span class="keywordflow">catch</span> (client::exception::session_expired&amp;) {</div>
<div class="line"><span class="lineno"> 1374</span>                    session_manager_.invalidate_session(group_id_, session_id);</div>
<div class="line"><span class="lineno"> 1375</span>                    throw_illegal_state_exception(std::current_exception());</div>
<div class="line"><span class="lineno"> 1376</span>                }</div>
<div class="line"><span class="lineno"> 1377</span>            });</div>
<div class="line"><span class="lineno"> 1378</span>}</div>
<div class="ttc" id="aclasshazelcast_1_1cp_1_1session__semaphore_html_a45e61b07294a4b94d54b40595264c917"><div class="ttname"><a href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a45e61b07294a4b94d54b40595264c917">hazelcast::cp::session_semaphore::DRAIN_SESSION_ACQ_COUNT</a></div><div class="ttdeci">static constexpr int32_t DRAIN_SESSION_ACQ_COUNT</div><div class="ttdoc">Since a proxy does not know how many permits will be drained on the Raft group, it uses this constant...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1d/cp_8h_source.html#l01301">cp.h:1301</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a587436f67435d1e51a0a94558d01ee2d" name="a587436f67435d1e51a0a94558d01ee2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a587436f67435d1e51a0a94558d01ee2d">&#9670;&#160;</a></span>drain_permits()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::future&lt; int32_t &gt; hazelcast::cp::session_semaphore::drain_permits </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/d2a/cp_8cpp_source.html#l01313">1313</a> of file <a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1314</span>{</div>
<div class="line"><span class="lineno"> 1315</span>    <span class="keyword">auto</span> thread_id = get_thread_id();</div>
<div class="line"><span class="lineno"> 1316</span>    <span class="keyword">auto</span> invocation_uid =</div>
<div class="line"><span class="lineno"> 1317</span>      get_context().get_hazelcast_client_implementation()-&gt;random_uuid();</div>
<div class="line"><span class="lineno"> 1318</span> </div>
<div class="line"><span class="lineno"> 1319</span>    <span class="keyword">auto</span> do_drain_once = ([=]() {</div>
<div class="line"><span class="lineno"> 1320</span>        <span class="keyword">auto</span> session_id =</div>
<div class="line"><span class="lineno"> 1321</span>          session_manager_.acquire_session(group_id_, <a class="code hl_variable" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a45e61b07294a4b94d54b40595264c917">DRAIN_SESSION_ACQ_COUNT</a>);</div>
<div class="line"><span class="lineno"> 1322</span>        <span class="keyword">auto</span> request = client::protocol::codec::semaphore_drain_encode(</div>
<div class="line"><span class="lineno"> 1323</span>          group_id_, object_name_, session_id, thread_id, invocation_uid);</div>
<div class="line"><span class="lineno"> 1324</span>        <span class="keywordflow">return</span> client::spi::impl::ClientInvocation::create(</div>
<div class="line"><span class="lineno"> 1325</span>                 context_, request, object_name_)</div>
<div class="line"><span class="lineno"> 1326</span>          -&gt;invoke()</div>
<div class="line"><span class="lineno"> 1327</span>          .then(</div>
<div class="line"><span class="lineno"> 1328</span>            boost::launch::sync,</div>
<div class="line"><span class="lineno"> 1329</span>            [=](boost::future&lt;client::protocol::ClientMessage&gt; f) {</div>
<div class="line"><span class="lineno"> 1330</span>                <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1331</span>                    <span class="keyword">auto</span> count = f.get().get_first_fixed_sized_field&lt;int32_t&gt;();</div>
<div class="line"><span class="lineno"> 1332</span>                    session_manager_.release_session(</div>
<div class="line"><span class="lineno"> 1333</span>                      group_id_, session_id, <a class="code hl_variable" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html#a45e61b07294a4b94d54b40595264c917">DRAIN_SESSION_ACQ_COUNT</a> - count);</div>
<div class="line"><span class="lineno"> 1334</span>                    <span class="keywordflow">return</span> count;</div>
<div class="line"><span class="lineno"> 1335</span>                } <span class="keywordflow">catch</span> (client::exception::session_expired&amp;) {</div>
<div class="line"><span class="lineno"> 1336</span>                    session_manager_.invalidate_session(group_id_, session_id);</div>
<div class="line"><span class="lineno"> 1337</span>                    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1338</span>                }</div>
<div class="line"><span class="lineno"> 1339</span>            });</div>
<div class="line"><span class="lineno"> 1340</span>    });</div>
<div class="line"><span class="lineno"> 1341</span> </div>
<div class="line"><span class="lineno"> 1342</span>    <span class="keywordflow">return</span> do_drain_once().then(</div>
<div class="line"><span class="lineno"> 1343</span>      boost::launch::sync, [=](boost::future&lt;int32_t&gt; f) {</div>
<div class="line"><span class="lineno"> 1344</span>          int32_t count = f.get();</div>
<div class="line"><span class="lineno"> 1345</span>          <span class="keywordflow">if</span> (count != -1) {</div>
<div class="line"><span class="lineno"> 1346</span>              <span class="keywordflow">return</span> count;</div>
<div class="line"><span class="lineno"> 1347</span>          }</div>
<div class="line"><span class="lineno"> 1348</span>          <span class="keywordflow">while</span> ((count = do_drain_once().get()) == -1) {</div>
<div class="line"><span class="lineno"> 1349</span>          }</div>
<div class="line"><span class="lineno"> 1350</span>          <span class="keywordflow">return</span> count;</div>
<div class="line"><span class="lineno"> 1351</span>      });</div>
<div class="line"><span class="lineno"> 1352</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e34f99259acb9505b168284025de536" name="a1e34f99259acb9505b168284025de536"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e34f99259acb9505b168284025de536">&#9670;&#160;</a></span>get_thread_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int64_t hazelcast::cp::session_semaphore::get_thread_id </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/d2a/cp_8cpp_source.html#l01307">1307</a> of file <a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1308</span>{</div>
<div class="line"><span class="lineno"> 1309</span>    <span class="keywordflow">return</span> util::get_current_thread_id();</div>
<div class="line"><span class="lineno"> 1310</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae667563d56071817a96d531ad7c0a5ce" name="ae667563d56071817a96d531ad7c0a5ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae667563d56071817a96d531ad7c0a5ce">&#9670;&#160;</a></span>release()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::future&lt; void &gt; hazelcast::cp::session_semaphore::release </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>permits</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/d2a/cp_8cpp_source.html#l01269">1269</a> of file <a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1270</span>{</div>
<div class="line"><span class="lineno"> 1271</span>    util::Preconditions::check_positive(permits, <span class="stringliteral">&quot;Permits must be positive!&quot;</span>);</div>
<div class="line"><span class="lineno"> 1272</span>    <span class="keyword">auto</span> session_id = session_manager_.get_session(group_id_);</div>
<div class="line"><span class="lineno"> 1273</span>    <span class="keywordflow">if</span> (session_id == internal::session::proxy_session_manager::NO_SESSION_ID) {</div>
<div class="line"><span class="lineno"> 1274</span>        throw_illegal_state_exception(<span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno"> 1275</span>    }</div>
<div class="line"><span class="lineno"> 1276</span> </div>
<div class="line"><span class="lineno"> 1277</span>    <span class="keyword">auto</span> thread_id = get_thread_id();</div>
<div class="line"><span class="lineno"> 1278</span>    <span class="keywordflow">return</span> do_release(permits, thread_id, session_id)</div>
<div class="line"><span class="lineno"> 1279</span>      .then([=](boost::future&lt;void&gt; f) {</div>
<div class="line"><span class="lineno"> 1280</span>          <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1281</span>              f.get();</div>
<div class="line"><span class="lineno"> 1282</span>              session_manager_.release_session(group_id_, session_id, permits);</div>
<div class="line"><span class="lineno"> 1283</span>          } <span class="keywordflow">catch</span> (client::exception::session_expired&amp;) {</div>
<div class="line"><span class="lineno"> 1284</span>              session_manager_.invalidate_session(group_id_, session_id);</div>
<div class="line"><span class="lineno"> 1285</span>              session_manager_.release_session(group_id_, session_id, permits);</div>
<div class="line"><span class="lineno"> 1286</span>              throw_illegal_state_exception(std::current_exception());</div>
<div class="line"><span class="lineno"> 1287</span>          }</div>
<div class="line"><span class="lineno"> 1288</span>      });</div>
<div class="line"><span class="lineno"> 1289</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a76c8b1a49de450489ca52579999b9e19" name="a76c8b1a49de450489ca52579999b9e19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76c8b1a49de450489ca52579999b9e19">&#9670;&#160;</a></span>throw_illegal_state_exception()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void hazelcast::cp::session_semaphore::throw_illegal_state_exception </td>
          <td>(</td>
          <td class="paramtype">std::exception_ptr&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/d2a/cp_8cpp_source.html#l01292">1292</a> of file <a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1293</span>{</div>
<div class="line"><span class="lineno"> 1294</span>    <span class="keyword">auto</span> ise = boost::enable_current_exception(client::exception::illegal_state(</div>
<div class="line"><span class="lineno"> 1295</span>      <span class="stringliteral">&quot;session_semaphore::illegal_state&quot;</span>, <span class="stringliteral">&quot;No valid session!&quot;</span>));</div>
<div class="line"><span class="lineno"> 1296</span>    <span class="keywordflow">if</span> (!e) {</div>
<div class="line"><span class="lineno"> 1297</span>        <span class="keywordflow">throw</span> ise;</div>
<div class="line"><span class="lineno"> 1298</span>    }</div>
<div class="line"><span class="lineno"> 1299</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1300</span>        std::rethrow_exception(e);</div>
<div class="line"><span class="lineno"> 1301</span>    } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno"> 1302</span>        std::throw_with_nested(ise);</div>
<div class="line"><span class="lineno"> 1303</span>    }</div>
<div class="line"><span class="lineno"> 1304</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad6838bccb7f850abcb34ac8596bfae43" name="ad6838bccb7f850abcb34ac8596bfae43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6838bccb7f850abcb34ac8596bfae43">&#9670;&#160;</a></span>try_acquire_for_millis()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::future&lt; bool &gt; hazelcast::cp::session_semaphore::try_acquire_for_millis </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>permits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/d2a/cp_8cpp_source.html#l01193">1193</a> of file <a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1195</span>{</div>
<div class="line"><span class="lineno"> 1196</span>    util::Preconditions::check_not_negative(</div>
<div class="line"><span class="lineno"> 1197</span>      permits, <span class="stringliteral">&quot;permits must not be negative number.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1198</span> </div>
<div class="line"><span class="lineno"> 1199</span>    <span class="keyword">auto</span> thread_id = get_thread_id();</div>
<div class="line"><span class="lineno"> 1200</span>    <span class="keyword">auto</span> invocation_uid =</div>
<div class="line"><span class="lineno"> 1201</span>      get_context().get_hazelcast_client_implementation()-&gt;random_uuid();</div>
<div class="line"><span class="lineno"> 1202</span> </div>
<div class="line"><span class="lineno"> 1203</span>    <span class="keyword">auto</span> do_try_acquire_once = ([=]() {</div>
<div class="line"><span class="lineno"> 1204</span>        <span class="keyword">auto</span> start = std::chrono::steady_clock::now();</div>
<div class="line"><span class="lineno"> 1205</span>        <span class="keyword">auto</span> use_timeout = timeout &gt;= std::chrono::milliseconds::zero();</div>
<div class="line"><span class="lineno"> 1206</span>        <span class="keyword">auto</span> session_id = session_manager_.acquire_session(group_id_, permits);</div>
<div class="line"><span class="lineno"> 1207</span>        <span class="keyword">auto</span> request =</div>
<div class="line"><span class="lineno"> 1208</span>          client::protocol::codec::semaphore_acquire_encode(group_id_,</div>
<div class="line"><span class="lineno"> 1209</span>                                                            object_name_,</div>
<div class="line"><span class="lineno"> 1210</span>                                                            session_id,</div>
<div class="line"><span class="lineno"> 1211</span>                                                            thread_id,</div>
<div class="line"><span class="lineno"> 1212</span>                                                            invocation_uid,</div>
<div class="line"><span class="lineno"> 1213</span>                                                            permits,</div>
<div class="line"><span class="lineno"> 1214</span>                                                            timeout.count());</div>
<div class="line"><span class="lineno"> 1215</span>        <span class="keywordflow">return</span> client::spi::impl::ClientInvocation::create(</div>
<div class="line"><span class="lineno"> 1216</span>                 context_, request, object_name_)</div>
<div class="line"><span class="lineno"> 1217</span>          -&gt;invoke()</div>
<div class="line"><span class="lineno"> 1218</span>          .then(</div>
<div class="line"><span class="lineno"> 1219</span>            boost::launch::sync,</div>
<div class="line"><span class="lineno"> 1220</span>            [=](boost::future&lt;client::protocol::ClientMessage&gt; f) {</div>
<div class="line"><span class="lineno"> 1221</span>                <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1222</span>                    <span class="keyword">auto</span> acquired = f.get().get_first_fixed_sized_field&lt;bool&gt;();</div>
<div class="line"><span class="lineno"> 1223</span>                    <span class="keywordflow">if</span> (!acquired) {</div>
<div class="line"><span class="lineno"> 1224</span>                        session_manager_.release_session(group_id_, session_id);</div>
<div class="line"><span class="lineno"> 1225</span>                    }</div>
<div class="line"><span class="lineno"> 1226</span>                    <span class="comment">// first bool means acquired or not, second bool means if</span></div>
<div class="line"><span class="lineno"> 1227</span>                    <span class="comment">// should try again</span></div>
<div class="line"><span class="lineno"> 1228</span>                    <span class="keywordflow">return</span> std::make_pair(acquired, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1229</span>                } <span class="keywordflow">catch</span> (client::exception::session_expired&amp;) {</div>
<div class="line"><span class="lineno"> 1230</span>                    session_manager_.invalidate_session(group_id_, session_id);</div>
<div class="line"><span class="lineno"> 1231</span>                    <span class="keywordflow">if</span> (use_timeout &amp;&amp;</div>
<div class="line"><span class="lineno"> 1232</span>                        (timeout - (std::chrono::steady_clock::now() - start) &lt;=</div>
<div class="line"><span class="lineno"> 1233</span>                         std::chrono::milliseconds::zero())) {</div>
<div class="line"><span class="lineno"> 1234</span>                        <span class="keywordflow">return</span> std::make_pair(<span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1235</span>                    }</div>
<div class="line"><span class="lineno"> 1236</span>                    <span class="keywordflow">return</span> std::make_pair(<span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1237</span>                } <span class="keywordflow">catch</span> (client::exception::wait_key_cancelled&amp;) {</div>
<div class="line"><span class="lineno"> 1238</span>                    session_manager_.release_session(</div>
<div class="line"><span class="lineno"> 1239</span>                      group_id_, session_id, permits);</div>
<div class="line"><span class="lineno"> 1240</span>                    <span class="keywordflow">if</span> (!use_timeout) {</div>
<div class="line"><span class="lineno"> 1241</span>                        BOOST_THROW_EXCEPTION(client::exception::illegal_state(</div>
<div class="line"><span class="lineno"> 1242</span>                          <span class="stringliteral">&quot;session_semaphore::try_acquire_for_millis&quot;</span>,</div>
<div class="line"><span class="lineno"> 1243</span>                          (boost::format(</div>
<div class="line"><span class="lineno"> 1244</span>                             <span class="stringliteral">&quot;Semaphore[%1%] not acquired because the acquire &quot;</span></div>
<div class="line"><span class="lineno"> 1245</span>                             <span class="stringliteral">&quot;call on the CP group is cancelled, possibly &quot;</span></div>
<div class="line"><span class="lineno"> 1246</span>                             <span class="stringliteral">&quot;because of another indeterminate call from the &quot;</span></div>
<div class="line"><span class="lineno"> 1247</span>                             <span class="stringliteral">&quot;same thread.&quot;</span>) %</div>
<div class="line"><span class="lineno"> 1248</span>                           object_name_)</div>
<div class="line"><span class="lineno"> 1249</span>                            .str()));</div>
<div class="line"><span class="lineno"> 1250</span>                    }</div>
<div class="line"><span class="lineno"> 1251</span>                    <span class="keywordflow">return</span> std::make_pair(<span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1252</span>                }</div>
<div class="line"><span class="lineno"> 1253</span>            });</div>
<div class="line"><span class="lineno"> 1254</span>    });</div>
<div class="line"><span class="lineno"> 1255</span> </div>
<div class="line"><span class="lineno"> 1256</span>    <span class="keywordflow">return</span> do_try_acquire_once().then(</div>
<div class="line"><span class="lineno"> 1257</span>      boost::launch::sync, [=](boost::future&lt;std::pair&lt;bool, bool&gt;&gt; f) {</div>
<div class="line"><span class="lineno"> 1258</span>          <span class="keyword">auto</span> result = f.get();</div>
<div class="line"><span class="lineno"> 1259</span>          <span class="keywordflow">if</span> (!result.second) {</div>
<div class="line"><span class="lineno"> 1260</span>              return result.first;</div>
<div class="line"><span class="lineno"> 1261</span>          }</div>
<div class="line"><span class="lineno"> 1262</span>          for (; result.second; result = do_try_acquire_once().get())</div>
<div class="line"><span class="lineno"> 1263</span>              ;</div>
<div class="line"><span class="lineno"> 1264</span>          <span class="keywordflow">return</span> result.first;</div>
<div class="line"><span class="lineno"> 1265</span>      });</div>
<div class="line"><span class="lineno"> 1266</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a45e61b07294a4b94d54b40595264c917" name="a45e61b07294a4b94d54b40595264c917"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45e61b07294a4b94d54b40595264c917">&#9670;&#160;</a></span>DRAIN_SESSION_ACQ_COUNT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr int32_t hazelcast::cp::session_semaphore::DRAIN_SESSION_ACQ_COUNT = 1024</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">constexpr</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Since a proxy does not know how many permits will be drained on the Raft group, it uses this constant to increment its local session acquire count. </p>
<p>Then, it adjusts the local session acquire count after the drain response is returned. </p>

<p class="definition">Definition at line <a class="el" href="../../d0/d1d/cp_8h_source.html#l01301">1301</a> of file <a class="el" href="../../d0/d1d/cp_8h_source.html">cp.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>hazelcast/include/hazelcast/cp/<a class="el" href="../../d0/d1d/cp_8h_source.html">cp.h</a></li>
<li>hazelcast/src/hazelcast/cp/<a class="el" href="../../d7/d2a/cp_8cpp_source.html">cp.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../de/db5/namespacehazelcast.html">hazelcast</a></li><li class="navelem"><b>cp</b></li><li class="navelem"><a class="el" href="../../d0/d45/classhazelcast_1_1cp_1_1session__semaphore.html">session_semaphore</a></li>
    <li class="footer">Generated on Wed Mar 15 2023 18:23:47 for Hazelcast C++ Client by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
