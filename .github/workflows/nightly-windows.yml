name: nightly-Windows

on: [ push ]

jobs:
  nightly-Windows:
    strategy:
      fail-fast: false
      matrix:
        arch:
          - cmake: Win32
            vcpkg_triplet: x86-windows
            address_model: 32
          - cmake: x64
            vcpkg_triplet: x64-windows
            address_model: 64
        build_type:
          - Debug
#          - Release
        shared_libs:
          - toggle: OFF
            name: Static
#          - toggle: ON
#            name: Shared
        with_openssl:
          - toggle: OFF
            name: 'noSSL'
#          - toggle: ON
#            name: 'SSL'

    runs-on: windows-latest
    name: >-
      Windows
      (${{ matrix.arch.cmake }}, ${{ matrix.build_type }}, ${{ matrix.shared_libs.name }}, ${{ matrix.with_openssl.name }})

    env:
      VCPKG_DEFAULT_TRIPLET: ${{ matrix.arch.vcpkg_triplet }}

    steps:
      - uses: actions/checkout@v2

      - name: Install Boost
        shell: pwsh
        run: |
          Invoke-WebRequest `
              "https://dl.bintray.com/boostorg/release/1.75.0/source/boost_1_75_0.tar.gz" `
              -OutFile "boost_1_75_0.tar.gz"

          tar xzf boost_1_75_0.tar.gz
          cd boost_1_75_0
          .\bootstrap.bat
          .\b2 address-model=${{ matrix.arch.address_model }} --with-thread --with-chrono install


      - name: Install Thrift
        run: |
          vcpkg install thrift
